<div class='container'>
  <script type="text/javascript">
    window.currentUser = {
        id : <%=current_user.id %>,
        name: '<%= current_user.name %>'
    }
  </script>
  <div class="modal fade" id='chat_request_dialog'>
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Wanna chat?</h4>
                  </div>
                  <div class="modal-body">
                    <p id='modal_body'>A friend wants to chat with you.</p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Decline</button>
                    <button type="button" class="btn btn-primary" id='yes' data-id='1'>Accept</button>
                  </div>
                </div><!-- /.modal-content -->
              </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->
    <div class='row'>
        <ul class="nav nav-tabs nav-justified">
          <li class='active'><a href="#home" data-toggle="tab">Home</a></li>
          <li><a href="#reviews" data-toggle="tab">Reviews</a></li>
          <li><a href="#ratings" data-toggle="tab">Ratings</a></li>
          <li><a href="#profile" data-toggle="tab">Profile</a></li>
          <li><a href="#friends" data-toggle="tab">Friends</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content" style='margin-right:10px;'>
          <div class="tab-pane active" id="home">
            <% if user_signed_in? %>
                <h3>Welcome, <%= current_user.name %></h3>
                <%=  %>
            <% end %>
          </div>
          <div class="tab-pane" id="reviews">
            <% if !@reviews.empty? and !@recent_reviews.empty? %>
                <h4>Recent activity: </h4>
                <ul class='list-unstyled'>
                    <% @reviews.zip(@recent_reviews)[0...5].each do |r, a| %>
                        <% if a != nil and r.review != nil %>
                        <li><a href='/album/details?remote_id=<%=r.reviewable.remote_id%>'><%= a.title %></a>: <%= r.review %><br/><a href='/album/details?remote_id=<%=r.reviewable.remote_id%>'><%= image_tag(a.image(100)) %></a></li>
                        <% end %>
                    <% end %>
                </ul>
                <% end %>
          </div>
          <div class="tab-pane" id="ratings">
            <h4>Recent Ratings:</h4>
            <ul class='list-unstyled'>
                <% i = 0 %>
                <% @ratings.zip(@recents).each do |r, a| %>
                    <% if a != nil and r.rating != nil %>
                        <li><%= a.artist.name %> - <a href='/album/details?remote_id=<%=a.id%>'><%= a.title %><br/><%= image_tag(a.image(100)) %></a>
                        <%= render '/stars_div', :i=>i %>
                        </li>
                        <%= render '/rating_js', :rating=>r, :i=>i, :album => a %>
                    <% end %>
                    <% i+=1 %>
                <% end %>
                
            </ul>
          </div>
          <div class="tab-pane" id="profile">
          <div class='col-md-6'>
            <h3>Upload an mp3</h3>
            <%= form_tag('/upload/uploadFile', id: 'uploadForm', multipart: true, remote: true) do %>
            <div class="input-group">
              <span class="input-group-btn">
                <span class="btn btn-primary btn-file">
                  Browse&hellip; <input type="file" id='file' name='file' accept='audio/*' >
                </span>
              </span>
              <input type="text" class="form-control" id='files' readonly>
            </div>
            <% end %>
            <br/>
            <div class="progress progress-striped active">
              <div class="progress-bar"  role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                <span class="sr-only"></span>
              </div>
            </div>
            <br/>
            <div class='panel panel-default'>
              <div class='panel-heading'>Uploaded files:</div>
                <div class='panel-body' style='height:200px;overflow-y:auto'>
                  <ul id="fileList" class='list-unstyled'>
                    <% @files.each do |f| %>
                      <li><%= f %></li>
                    <% end %>
                  </ul>
                </div>
              </div>
          </div>
            <br/>
            <div class='col-md-6'>
            <div class='panel panel-default'>
              <div class='panel-heading'>Recommendations:</div>
                <div class='panel-body' style='height:200px;overflow-y:auto'>
                  <ul class='list-unstyled'>
                    <% if @recommends != nil %>
                    <% @recommends.each do |f| %>
                        <li><a href='/details?artist_id=<%= f.id %>'><%= f.name %></a></li>
                    <% end %>
                    <% end %>
                  </ul>
                </div>
              </div>
            </div>
            <div class='col-md-6'>
              <%= form_for current_user, url: '/user/'+current_user.id.to_s+'/update', class: 'form' do |u| %>
              <p>Name: <%= u.text_field :name, class: 'form-control' %></p>
              <p>Email: <%= u.text_field :email, class: 'form-control' %></p> 
              <%= u.submit 'Save', class: 'form-control' %>
              <% end %>
            </div>
          </div>
          <div class="tab-pane" id="friends">
            <h4>Friends:</h4>
            <ul class='list-unstyled' >
                <% current_user.friends.each_with_index do |f, i| %>
                    <li><a href='/user/<%= f.id %>' id='friend<%= f.id %>'><%= f.name %></a>
                      <a href='/initiate_chat?id=<%=current_user.id%>&friend_id=<%=f.id%>' data-remote="true" id='chat_link<%= f.id %>' </a></li>
                <% end %>
            </ul>
          </div>
        </div>

    </div>
</div>
